<!-- templates/sidebar.html -->
<nav class="sidebar">
    <div class="sidebar-header">
        <img src="{{ url_for('static', filename='images/logiai-text.jpg') }}" alt="logiAI logo">
    </div>

    <ul class="sidebar-menu">
        <li class="{% if request.endpoint == 'home.home' %}active{% endif %}"><a href="{{ url_for('home.home') }}"><img src="{{ url_for('static', filename='icons/home.png') }}" alt="home"> {{ _("Kezdőlap") }}</a></li>
        <li class="{% if request.endpoint == 'shipments' %}active{% endif %}"><a href="{{ url_for('shipments') }}"><img src="{{ url_for('static', filename='icons/warehouse.png') }}" alt="shipments"> {{ _("Rakományt keresek") }}</a></li>
        <li class="{% if request.endpoint == 'cargo.cargo' %}active{% endif %}"><a href="{{ url_for('cargo.cargo') }}"><img src="{{ url_for('static', filename='icons/truck.png') }}" alt="cargo"> {{ _("Járművet keresek") }}</a></li>
        <li class="{% if request.endpoint == 'vehicles.vehicles' %}active{% endif %}"><a href="{{ url_for('vehicles.vehicles') }}"><img src="{{ url_for('static', filename='icons/car.png') }}" alt="vehicles"> {{ _("Saját járművek") }}</a></li>

        <!-- Cégek (lenyíló) -->
        <li class="{% if request.endpoint == 'company.my_company' or request.endpoint == 'company.companies' %}active{% endif %}">
            <a href="#" class="submenu-toggle"><img src="{{ url_for('static', filename='icons/company.png') }}" alt="company"> {{ _("Cégek") }}</a>
            <ul class="submenu">
                <li><a href="{{ url_for('company.my_company') }}">{{ _("Saját cég") }}</a></li>
                <li><a href="{{ url_for('company.companies') }}">{{ _("Cégkereső") }}</a></li>
            </ul>
        </li>
        <li class="{% if request.endpoint == 'profile.profile' %}active{% endif %}">
            <a href="{{ url_for('profile.profile') }}">
                {% if unseen_incoming_offers_count and unseen_incoming_offers_count > 0 %}
                    <img src="{{ url_for('static', filename='icons/user_alert.png') }}" alt="profile">
                {% else %}
                    <img src="{{ url_for('static', filename='icons/user.png') }}" alt="profile">
                {% endif %}
                {{ _("Profil") }}
            </a>
        </li>
        <li class="{% if request.endpoint == 'statistics.statistics' %}active{% endif %}"><a href="{{ url_for('statistics.statistics') }}"><img src="{{ url_for('static', filename='icons/stats.png') }}" alt="statistics"> {{ _("Statisztika") }}</a></li>
    </ul>
    <!-- Logout gomb a sidebar alján -->
    <ul class="sidebar-logout">
        <li class="{% if request.endpoint == 'profile.settings' %}active{% endif %}">
            <a href="{{ url_for('profile.settings') }}" class="settings-btn">
                <img src="{{ url_for('static', filename='icons/settings.png') }}" alt="settings"> {{ _("Beállítások") }}
            </a>
        </li>
        <li>
            <a href="{{ url_for('login.logout') }}" class="logout-btn">
                <img src="{{ url_for('static', filename='icons/exit.png') }}" alt="logout"> {{ _("Kijelentkezés") }}
            </a>
        </li>
    </ul>
</nav>

<!-- Inline script: kis JS a toggle-hoz (beilleszthető külön JS fájlba is) -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const toggle = document.querySelector('.submenu-toggle');
    if (!toggle) return;

    const submenu = document.getElementById(toggle.getAttribute('aria-controls'));

    // visszaállítás localStorage-ból (opcionális)
    try {
        const key = 'sidebar_companies_open';
        const saved = localStorage.getItem(key);
        if (saved === '1') {
            submenu.hidden = false;
            toggle.setAttribute('aria-expanded', 'true');
            toggle.classList.add('open');
        }

        toggle.addEventListener('click', function() {
            const isOpen = toggle.getAttribute('aria-expanded') === 'true';
            if (isOpen) {
                submenu.hidden = true;
                toggle.setAttribute('aria-expanded', 'false');
                toggle.classList.remove('open');
                localStorage.setItem(key, '0');
            } else {
                submenu.hidden = false;
                toggle.setAttribute('aria-expanded', 'true');
                toggle.classList.add('open');
                localStorage.setItem(key, '1');
            }
        });
    } catch (e) {
        // ha localStorage tiltott - csak toggle
        toggle.addEventListener('click', function() {
            const isOpen = toggle.getAttribute('aria-expanded') === 'true';
            submenu.hidden = isOpen;
            toggle.setAttribute('aria-expanded', String(!isOpen));
            toggle.classList.toggle('open');
        });
    }
});
document.querySelectorAll('.submenu-toggle').forEach(function(toggle) {
    toggle.addEventListener('click', function(e) {
        e.preventDefault();
        const submenu = this.nextElementSibling;

        // pozicionálás: a menüpont tetejéhez igazítjuk
        const rect = this.getBoundingClientRect();
        submenu.style.top = `${this.offsetTop}px`; // vagy rect.top + scrollY, ha scroll van
        submenu.classList.toggle('active');
    });
});

// Opció: kattintás bárhova a menün kívül bezárja az almenüt
document.addEventListener('click', function(e) {
    document.querySelectorAll('.submenu').forEach(function(menu) {
        if (!menu.contains(e.target) && !menu.previousElementSibling.contains(e.target)) {
            menu.classList.remove('active');
        }
    });
});

</script>
